{"ast":null,"code":"import { getDataJson, pollingRefresh } from '@/utils';\nexport default {\n  name: 'Pie',\n  props: {\n    cptId: {\n      type: String,\n      default: ''\n    },\n    width: Number,\n    height: Number,\n    configProps: {\n      type: Object,\n      default: () => {}\n    }\n  },\n  data() {\n    return {\n      uuid: '',\n      chartOption: {},\n      chart: undefined,\n      cptData: []\n    };\n  },\n  watch: {\n    'configProps.attribute': {\n      handler(newObj) {\n        this.loadChart(newObj);\n      },\n      deep: true // 深度监听\n    },\n\n    width() {\n      this.chart.resize();\n    },\n    height() {\n      this.chart.resize();\n    }\n  },\n  created() {\n    this.uuid = require('uuid').v1();\n  },\n  mounted() {\n    this.chart = this.$echarts.init(document.getElementById(this.uuid));\n    this.refreshCptData();\n  },\n  methods: {\n    refreshCptData() {\n      pollingRefresh(this.uuid, this.configProps.cptDataForm, this.loadData);\n    },\n    loadData() {\n      getDataJson(this.configProps.cptDataForm, this.cptId).then(res => {\n        this.cptData = res;\n        this.loadChart(this.configProps.attribute);\n      });\n    },\n    loadChart(attribute) {\n      const that = this;\n      that.chartOption = {\n        color: attribute.pieColor,\n        title: {\n          text: attribute.chartTitle,\n          subtext: attribute.subtext,\n          left: attribute.titleX,\n          top: attribute.titleY,\n          textStyle: {\n            fontSize: attribute.titleFontSize,\n            color: attribute.titleTextColor\n          },\n          // 副标题文本样式设置\n          subtextStyle: {\n            fontSize: 12,\n            color: attribute.subtextColor\n          }\n        },\n        tooltip: {\n          trigger: 'item'\n        },\n        legend: {\n          show: attribute.legendShow,\n          orient: attribute.orient,\n          x: attribute.legendX,\n          y: attribute.legendY,\n          textStyle: {\n            color: attribute.legendTextColor,\n            fontSize: attribute.legendFontSize\n          }\n        },\n        series: [{\n          name: attribute.chartTitle,\n          type: 'pie',\n          roseType: attribute.roseType === 'false' ? false : attribute.roseType,\n          radius: [attribute.radiusInside + '%', attribute.radiusOutside + '%'],\n          label: {\n            position: attribute.labelPosition,\n            fontSize: attribute.labelFontSize,\n            color: attribute.labelColor\n          },\n          itemStyle: {\n            borderRadius: attribute.borderRadius\n            // todo 背景图\n            // color: {\n            //   image: new Image().src = '',\n            //   repeat: 'repeat'\n            // }\n          },\n\n          data: this.cptData,\n          emphasis: {\n            itemStyle: {\n              shadowBlur: 10,\n              shadowOffsetX: 0,\n              shadowColor: 'rgba(255, 0, 0, 0.5)'\n            }\n          }\n        }]\n      };\n      that.chart.setOption(that.chartOption);\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}